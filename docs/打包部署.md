通过SCF CLI ，我们可以简单地执行命令，将本地云函数项目部署至云端，并可以在本地 CLI 查看云端函数运行的日志 。

## 函数部署

scf cli通过 `deploy` 子命令来完成函数打包部署。scf 命令行工具依据指定的函数模板配置文件，将配置文件中指定的代码包、函数配置等信息，部署到云端，或更新云端的函数。
>! `scf deploy` 命令的执行过程均基于函数模板配置文件，具体的模板文件说明和写法请见 [模板文件说明](https://cloud.tencent.com/document/product/583/33454)。

### 参数说明

`scf deploy` 命令支持的参数如下：

| 参数          | 简写 | 必填 | 描述                                                | 示例        |
| ------------- | ---- | ---- | --------------------------------------------------- | ----------- |
| template-file | -t   | 否   | 函数项目的部署用配置文件，支持 yaml 格式文件        | deploy.yaml |
| forced        | -f   | 否   | 当函数已存在时，强制更新并覆盖原有函数。默认为false |             |
| cos-bucket    | -c   | 否   | 上传代码包至指定 COS bucket                         | test-cos    |
| name          | -n   | 否   | 函数名                                              | test-func   |
| namespace     | -ns  | 否   | 命名空间，默认为 default                            | test-ns     |
| region        | -r   | 否   | 部署区域，默认为 `scf configure` 配置的 region      | ap-beijing  |
| skip-event    | 无   | 否   | 维持老版本的触发器，此次不要覆盖触发器              |             |

### 使用示例

进入函数项目目录，执行以下命令，并部署程序包。

```bash
$ cd /Users/xxx/code/scf/testproject

$ scf deploy
Compress function './.tcf_build/default-test-func-latest.zip' to zipfile 'default-test-func-latest.zip' success
Deploy namespace 'default' begin
Deploy function 'testproject' success
Deploy namespace 'default' end
```

部署成功后，即可在控制台上的函数列表中，查询到已创建的 “testproject” 函数。

>? 如需修改代码，请在完成修改代码后重新部署。若模板配置文件没有修改，函数将进行更新操作。
>

修改代码后，需要重新打包上传的操作示例如下：

```bash
$ cd testproject
$ vim index.py

$ scf deploy
Deploy  function 'testproject' success

```

## 代码上传方式

目前 scf cli工具支持以下两种上传方式：
- 通过 COS 对象存储上传代码
- 通过本地 zip 包上传代码

<span id="COSUploadCode"></span>

### 通过 COS 对象存储上传代码

使用 `deploy` 命令时，指定 cos bucket 参数，即可将 zip 包上传至指定的 bucket 中。部署时，云端将会从 cos bucket 拉取代码包。

#### 使用示例

本示例假设，在环境为 Python 2.7下，/Users/xxx/code/scf 目录中创建 testproject 项目。

1. 执行以下命令，进入对应目录，打包配置文件并将 COS bucket 指定为 "temp-code-1253970226"。

>! COS bucket 需要与函数在相同地域。
>

```bash
$ cd /Users/xxx/code/scf/testproject
$ scf deploy --cos-bucket temp-code-1253970226
Compress function './.tcf_build/default-testproject-latest.zip' to zipfile 'default-testproject-latest.zip' success
2019-07-17 10:42:20 put object, url=:https://temp-code-1253970226.cos.ap-shanghai.myqcloud.com/default-testproject-latest-2019-07-17-10-42-20.zip ,headers=:{'x-cos-acl': 'public-read', 'Content-Type': 'application/x-zip-compressed'}
Upload function zip file 'default-testproject-latest-2019-07-17-10-42-20.zip' to COS bucket 'temp-code-1253970226' success
```

根据返回的信息，得知本地创建 zip 文件后，scf 将 zip 包传递到 COS bucket 中。云端从 COS bucket 拉取代码包并部署成功。

### 通过本地 zip 包上传代码

>!  当您通过本地 zip 包上传代码的方式创建函数时， zip 包的大小不能大于30MB。超过30MB的 zip 包将无法直接创建函数。若 zip 包大于30MB，建议您选择 [通过 COS 对象存储上传代码](#COSUploadCode) 方式进行创建。
>

`delpoy` 子命令中的示例均以本地 zip 包上传方式完成。使用本地代码包上传方式时，`deploy` 子命令无需带有 cos-bucket 参数，scf cli会将本地代码打包并生成一个随机名的 zip 文件然后部署至云端。



## 日志查看

scf cli 可以通过 `logs` 	命令查看云端函数产生的历史或实时日志。

### 参数说明

`scf logs` 命令支持的参数如下：

| 参数       | 简写 | 必填 | 描述                       | 示例                 |
| ---------- | ---- | ---- | -------------------------- | -------------------- |
| name       | -n   | 是   | 获取指定函数的日志         | testproject          |
| namespace  | -ns  | 否   | 指定函数所在命名空间       | test-ns              |
| region     | 无   | 否   | 指定函数所在区域           | ap-shanghai          |
| start-time | -s   | 否   | 获取指定开始时间之后的日志 | "2019-7-12 00:00:00" |
| End-time   | -e   | 否   | 获取指定开始时间之前的日志 | "2019-7-12 00:10:00" |
| fail       | -f   | 否   | 获取调用失败的日志         |                      |
| tail       | -t   |      | 获取最新的实时日志         |                      |
| duration   | -d   | 否   | 获取最近 x 秒 的日志       | 600                  |
| count      | -c   | 否   | 获取 x 条日志              | 1                    |

> ! 注意: 拉取日志最大行数为 10000 行

### 使用示例

以下示例假设已在云端 ap-shanghai 区域，default 命名空间下，运行了 testproject 函数。

- 获取指定函数的日志

```bash
$ scf logs -n testproject
2019-07-17 11:16:39
START RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
Event RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
{'key2': 'test value 2', 'key1': 'test value 1'}
```

> ! 不加 --offset 参数，默认获取最近 1min 的日志 ；
>
> 不加 --region 参数，默认为scf configure 里的 region；
>
> 不加 --namespace 参数，默认为 default 命名空间

- 获取指定区域里，指定命名空间下，指定函数的日志

```bash
$  scf logs -n testproject --region ap-shanghai -ns default
2019-07-17 11:16:39
START RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
Event RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
{'key2': 'test value 2', 'key1': 'test value 1'}
```

- 获取最近10分钟的日志

```bash
$ scf logs -n testproject -o 600
2019-07-17 11:16:39
START RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
Event RequestId: 4af1a378-a841-11e9-95cb-525400e8849e
{'key2': 'test value 2', 'key1': 'test value 1'}
```

- 获取实时日志

```bash
$ scf logs -n testproject -t
2019-07-17 11:42:52
START RequestId: f4739afa-a844-11e9-91a1-525400681fe1
Event RequestId: f4739afa-a844-11e9-91a1-525400681fe1
{'key2': 'test value 2', 'key1': 'test value 1'}

END RequestId: f4739afa-a844-11e9-91a1-525400681fe1
Report RequestId: f4739afa-a844-11e9-91a1-525400681fe1 Duration:0ms Memory:128MB MaxMemoryUsed:0.062500MB
```

- 获取函数指定时间段的日志

```bash
$ scf logs -n testproject -s "2019-7-17 11:20:00"  -e "2019-7-17 11:30:00" 
2019-07-17 11:20:10
START RequestId: c86f1057-a841-11e9-a24c-525400b2c41b
Event RequestId: c86f1057-a841-11e9-a24c-525400b2c41b
{'key2': 'test value 2', 'key1': 'test value 1'}

END RequestId: c86f1057-a841-11e9-a24c-525400b2c41b
Report RequestId: c86f1057-a841-11e9-a24c-525400b2c41b Duration:0ms Memory:128MB MaxMemoryUsed:0.050781MB
2019-07-17 11:20:14
START RequestId: cb118078-a841-11e9-95cb-525400e8849e
Event RequestId: cb118078-a841-11e9-95cb-525400e8849e
{'key2': 'test value 2', 'key1': 'test value 1'}
```

- 获取调用失败的日志

```bash
$ scf logs -n testproject -f
2019-07-17 11:47:38
START RequestId: 9f15534d-a845-11e9-95cc-525400e8849e
Event RequestId: 9f15534d-a845-11e9-95cc-525400e8849e

END RequestId: 9f15534d-a845-11e9-95cc-525400e8849e
Report RequestId: 9f15534d-a845-11e9-95cc-525400e8849e Duration:0ms Memory:128MB MaxMemoryUsed:0.148438MB
```

